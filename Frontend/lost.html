<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lost Items - QISCET ReclaimHub</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-bg: #f4f6f9;
      --card-bg: #ffffff;
      --text-dark: #2c3e50;
      --text-light: #7f8c8d;
      --accent-green: #27ae60;
      --accent-red: #e74c3c;
      --border-color: #dfe4ea;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--primary-bg);
      color: var(--text-dark);
      display: none; /* Show after DOM ready */
    }

    .site-header {
      background-color: var(--card-bg);
      padding: 10px 0;
      border-bottom: 1px solid var(--border-color);
    }
    .site-header .logo h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
      margin: 0;
    }
    .site-header .nav-links {
      gap: 20px;
    }
    .site-header .nav-links a {
      text-decoration: none;
      color: var(--text-light);
      font-weight: 500;
      padding: 8px 0;
      border-bottom: 3px solid transparent;
      transition: color 0.3s, border-color 0.3s;
    }
    .site-header .nav-links a:hover {
      color: var(--text-dark);
    }
    .site-header .nav-links a.active {
      color: var(--text-dark);
      border-bottom-color: var(--text-dark);
    }

    .page-title-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .page-title-section h1 {
      font-size: 2rem;
      font-weight: 600;
    }
    .btn-report {
      background-color: var(--accent-red);
      color: white;
      font-weight: 600;
      border-radius: 8px;
      padding: 10px 24px;
    }
    .btn-report:hover {
      color: white;
      opacity: 0.9;
    }

    .filter-section input, .filter-section select {
      padding: 12px 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
    }

    .item-card {
      background-color: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s, box-shadow 0.3s;
      height: 100%;
    }
    .item-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    .item-image-placeholder {
      height: 200px;
      background-color: #e9ecef;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--text-light);
      font-size: 1.2rem;
      font-weight: 500;
    }
    .item-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }
    .item-card .card-body {
      padding: 1.25rem;
    }
    .item-card .card-title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .item-card .card-text {
      color: var(--text-light);
      font-size: 0.95rem;
    }

    .footer {
      background: #212529;
      color: #fff;
      padding: 50px 0 20px;
      margin-top: 5rem;
    }
    .footer h5 { font-weight: 600; }
    .footer a { color: #ccc; text-decoration: none; }
    .footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="site-header sticky-top">
    <nav class="navbar navbar-expand-lg">
      <div class="container">
        <a class="logo" href="./home.html"><h2>QISCET RECLAIM HUB</h2></a>
        <div class="d-flex align-items-center ms-auto">
          <ul class="nav-links navbar-nav mx-4">
            <li class="nav-item"><a class="nav-link" href="./home.html">Home</a></li>
            <li class="nav-item"><a class="nav-link active" href="./lost.html">Lost Items</a></li>
            <li class="nav-item"><a class="nav-link" href="./found.html">Found Items</a></li>
          </ul>
          <a href="#" class="btn btn-login" id="loginLogoutBtn">Login</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="container my-5">
    
    <!-- Page Header -->
    <section class="page-title-section">
        <h1>Reported Lost Items</h1>
        <button class="btn btn-report" data-bs-toggle="modal" data-bs-target="#reportItemModal">Report a Lost Item</button>
    </section>

    <!-- Filter Bar -->
    <section class="filter-section row g-3 mb-5">
        <div class="col-md-8">
            <input type="text" id="searchInput" class="form-control" placeholder="Search for an item (e.g., 'black wallet')">
        </div>
        <div class="col-md-4">
            <select id="categoryFilter" class="form-select">
                <option selected>Filter by Category</option>
                <option>Electronics</option>
                <option>Bags & Luggage</option>
                <option>Jewelry & Accessories</option>
                <option>Keys</option>
                <option>Clothing</option>
                <option>Other</option>
            </select>
        </div>
    </section>

    <!-- Lost Items Grid -->
    <section>
        <div id="itemsGrid" class="row g-4">
            <!-- Items will be dynamically inserted here -->
        </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-3">
          <h5>About QISCET ReclaimHub</h5>
          <p>Helping students and staff report, track, and return lost and found items on campus safely.</p>
        </div>
        <div class="col-md-4 mb-3">
          <h5>Quick Links</h5>
          <ul class="list-unstyled">
            <li><a href="./home.html">Home</a></li>
            <li><a href="./lost.html">Lost Items</a></li>
            <li><a href="./found.html">Found Items</a></li>
          </ul>
        </div>
        <div class="col-md-4 mb-3">
          <h5>Contact Us</h5>
          <p>Email: support@qiscet.edu.in<br>Address: QIS College of Engineering & Technology, Ongole</p>
        </div>
      </div>
      <hr>
      <div class="text-center">
        <p class="mb-0">&copy; 2025 QISCET ReclaimHub. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Report Item Modal -->
  <div class="modal fade" id="reportItemModal" tabindex="-1" aria-labelledby="reportItemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reportItemModalLabel">Report a Lost Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p class="text-center text-muted mb-4">
              Lost something? Fill in the details to make sure it gets safely back to you.
            </p>
            <form id="itemForm" enctype="multipart/form-data">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Item Name</label>
                  <input type="text" class="form-control" name="Item_Name" placeholder="E.g., Wallet, Laptop" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Category</label>
                  <select name="category" class="form-control" required>
                    <option value="">Select Category</option>
                    <option>Electronics</option> <option>Bags & Luggage</option> <option>Jewelry & Accessories</option>
                    <option>Keys</option> <option>Clothing</option> <option>Other</option>
                  </select>
                </div>
                <div class="col-12">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" name="Description" rows="2" placeholder="Add details to help identify your item" required></textarea>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Date Lost</label>
                  <input type="date" class="form-control" name="Date_lost" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Location Lost</label>
                  <input type="text" class="form-control" name="Location_lost" placeholder="E.g., Library, Cafeteria" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Your Name</label>
                  <input type="text" class="form-control" name="reportedBy" placeholder="Your full name" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Contact Number</label>
                    <input type="tel" class="form-control" name="contactNo" placeholder="Your phone number" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" name="email" placeholder="Your email" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Upload Photo</label>
                  <input type="file" class="form-control" name="itemPhoto" accept="image/*">
                </div>
              </div>
              <button type="submit" class="btn btn-primary mt-4 w-100">Submit Report</button>
            </form>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="itemDetailsModal" tabindex="-1" aria-labelledby="itemDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="itemDetailsModalLabel">Item Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Item details inserted dynamically -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="confirmClaimBtn">Claim Item</button>
      </div>
    </div>
  </div>
</div>

  <!-- Scripts -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.body.style.display = "block";

  const form = document.getElementById("itemForm");
  const itemsGrid = document.getElementById("itemsGrid");
  const searchInput = document.getElementById("searchInput");
  const categoryFilter = document.getElementById("categoryFilter");
  const reportModalEl = document.getElementById('reportItemModal');
  const reportModal = bootstrap.Modal.getOrCreateInstance(reportModalEl);
  const loginLogoutBtn = document.getElementById('loginLogoutBtn');

  let allItems = [];
  let selectedItem = null;

  // ===== Login / Logout =====
  const isLoggedIn = localStorage.getItem('loggedIn') === 'true';
  if (isLoggedIn) {
    loginLogoutBtn.textContent = 'Logout';
  } else {
    loginLogoutBtn.textContent = 'Login';
    loginLogoutBtn.href = './login.html';
  }

  loginLogoutBtn.addEventListener('click', (e) => {
    if (isLoggedIn) {
      e.preventDefault();
      localStorage.removeItem('loggedIn');
      localStorage.removeItem('userEmail');
      window.location.reload();
    }
  });

  if(!isLoggedIn){
    window.location.href="login.html";
  }

  // ===== Event Listeners =====
  form.addEventListener("submit", handleFormSubmit);
  searchInput.addEventListener('keyup', handleFiltering);
  categoryFilter.addEventListener('change', handleFiltering);
  document.addEventListener("click", handleClaimClick);

  // ===== Load Items =====
  loadItems();

  async function handleFormSubmit(e) {
    e.preventDefault();
    const formData = new FormData(form);

    try {
      const response = await fetch("https://lost-and-found-udyt.onrender.com/lost/add", {
        method: "POST",
        body: formData
      });
      const data = await response.json();
      alert(data.message);
      form.reset();
      reportModal.hide();
      loadItems();
    } catch (err) {
      console.error("Error submitting form:", err);
      alert("Failed to report item. Please try again.");
    }
  }

  async function loadItems() {
    try {
      const response = await fetch("https://lost-and-found-udyt.onrender.com/lost");
      const data = await response.json();
      allItems = data.items || [];
      renderItems(allItems);
    } catch (err) { 
      console.error("Error loading items:", err); 
      itemsGrid.innerHTML = `<p class="text-center text-danger">Could not load items. Please check the connection.</p>`;
    }
  }

  function renderItems(itemsToDisplay) {
    if (itemsToDisplay.length === 0) {
      itemsGrid.innerHTML = `<p class="text-center text-muted col-12">No items match your search.</p>`;
      return;
    }

    itemsGrid.innerHTML = itemsToDisplay.map(item => `
      <div class="col-lg-3 col-md-4 col-sm-6">
        <div class="card item-card">
          ${item.upload_photo 
            ? `<img src="https://lost-and-found-udyt.onrender.com${item.upload_photo}" class="item-image" alt="${item.Item_Name}">` 
            : '<div class="item-image-placeholder"><span>Item Image</span></div>'
          }
          <div class="card-body">
            <h5 class="card-title">${item.Item_Name}</h5>
            <p class="card-text">Lost near ${item.Location_lost} on ${new Date(item.Date_lost).toLocaleDateString()}.</p>
            <button class="btn btn-sm btn-outline-primary w-100 view-btn" data-id="${item._id}">View Details</button>
          </div>
        </div>
      </div>
    `).join("");
  }

  function handleFiltering() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedCategory = categoryFilter.value;

    let filteredItems = allItems.filter(item => {
      const nameMatch = item.Item_Name.toLowerCase().includes(searchTerm);
      const descriptionMatch = item.Description.toLowerCase().includes(searchTerm);
      const categoryMatch = selectedCategory === 'Filter by Category' || item.category === selectedCategory;
      return (nameMatch || descriptionMatch) && categoryMatch;
    });

    renderItems(filteredItems);
  }

  async function handleClaimClick(e) {
    if (e.target.classList.contains("view-btn")) {
      const itemId = e.target.getAttribute("data-id");
      selectedItem = allItems.find(i => i._id === itemId);
      if (selectedItem) showItemDetails(selectedItem);
    }

    if (e.target.id === "confirmClaimBtn") {
      if (!selectedItem) return;

      const claimerName = localStorage.getItem("username") || prompt("Enter your full name:");
      const claimerEmail = localStorage.getItem("userEmail") || prompt("Enter your email:");

      if (!claimerName || !claimerEmail) {
        alert("Both name and email are required.");
        return;
      }

      try {
        const res = await fetch(`https://lost-and-found-udyt.onrender.com/lost/claim/${selectedItem._id}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ claimerName, claimerEmail })
        });

        const data = await res.json();

        if (!res.ok) {
          alert(data.message || "Failed to claim item");
          return;
        }

        alert(data.message || "Item claimed successfully!");
        const modalEl = document.getElementById('itemDetailsModal');
        const detailsModal = bootstrap.Modal.getInstance(modalEl);
        detailsModal.hide();

        allItems = allItems.filter(i => i._id !== selectedItem._id);
        handleFiltering();
      } catch (err) {
        console.error("Error claiming item:", err);
        alert("Failed to process claim. Please try again.");
      }
    }
  }

  function showItemDetails(item) {
    const modalEl = document.getElementById('itemDetailsModal');
    const modalBody = modalEl.querySelector('.modal-body');

    modalBody.innerHTML = `
      <div class="text-center mb-3">
        ${item.upload_photo
          ? `<img src="https://lost-and-found-udyt.onrender.com${item.upload_photo}" class="img-fluid rounded mb-3" style="max-height: 250px;">`
          : `<div class="item-image-placeholder"><span>No Image</span></div>`
        }
      </div>
      <h5><strong>${item.Item_Name}</strong></h5>
      <p><strong>Category:</strong> ${item.category}</p>
      <p><strong>Description:</strong> ${item.Description}</p>
      <p><strong>Date Lost:</strong> ${new Date(item.Date_lost).toLocaleDateString()}</p>
      <p><strong>Location Lost:</strong> ${item.Location_lost}</p>
      <p><strong>Reported By:</strong> ${item.reportedBy}</p>
      <p><strong>Contact:</strong> ${item.contactNo}</p>
    `;

    const detailsModal = new bootstrap.Modal(modalEl);
    detailsModal.show();
  }
});
</script>



</body>
</html>
