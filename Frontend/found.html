<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Found Items - QISCET ReclaimHub</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-bg: #f4f6f9;
      --card-bg: #ffffff;
      --text-dark: #2c3e50;
      --text-light: #7f8c8d;
      --accent-green: #27ae60;
      --accent-red: #e74c3c;
      --border-color: #dfe4ea;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--primary-bg);
      color: var(--text-dark);
      display: none;
    }

    .site-header {
      background-color: var(--card-bg);
      padding: 10px 0;
      border-bottom: 1px solid var(--border-color);
    }

    .nav-links a.active {
      color: var(--text-dark);
      border-bottom: 3px solid var(--text-dark);
    }

    .page-title-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .btn-report {
      background-color: var(--accent-red);
      color: white;
      font-weight: 600;
      border-radius: 8px;
      padding: 10px 24px;
    }

    .item-card {
      background-color: var(--card-bg);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      transition: 0.3s;
    }

    .item-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .item-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .footer {
      background: #212529;
      color: #fff;
      padding: 50px 0 20px;
      margin-top: 5rem;
    }

    .footer a { color: #ccc; text-decoration: none; }
    .footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header sticky-top">
    <nav class="navbar navbar-expand-lg">
      <div class="container">
        <a class="logo" href="./home.html"><h2>QISCET RECLAIM HUB</h2></a>
        <div class="d-flex align-items-center ms-auto">
          <ul class="nav-links navbar-nav mx-4">
            <li class="nav-item"><a class="nav-link" href="./home.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="./lost.html">Lost Items</a></li>
            <li class="nav-item"><a class="nav-link active" href="./found.html">Found Items</a></li>
          </ul>
          <a href="#" class="btn btn-login" id="loginLogoutBtn">Login</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="container my-5">
    <!-- Page Header -->
    <section class="page-title-section">
      <h1>Reported Found Items</h1>
      <button class="btn btn-report" data-bs-toggle="modal" data-bs-target="#reportItemModal">Report a Found Item</button>
    </section>

    <!-- Filter Bar -->
    <section class="filter-section row g-3 mb-5">
      <div class="col-md-8">
        <input type="text" id="searchInput" class="form-control" placeholder="Search for an item (e.g., 'black wallet')">
      </div>
      <div class="col-md-4">
        <select id="categoryFilter" class="form-select">
          <option selected>Filter by Category</option>
          <option>Electronics</option>
          <option>Bags & Luggage</option>
          <option>Jewelry & Accessories</option>
          <option>Keys</option>
          <option>Clothing</option>
          <option>Other</option>
        </select>
      </div>
    </section>

    <!-- Items Grid -->
    <section>
      <div id="itemsGrid" class="row g-4"></div>
    </section>
  </main>

  <!-- Report Item Modal -->
  <div class="modal fade" id="reportItemModal" tabindex="-1" aria-labelledby="reportItemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reportItemModalLabel">Report a Found Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="itemForm" enctype="multipart/form-data">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Item Name</label>
                <input type="text" class="form-control" name="Item_Name" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Category</label>
                <select name="category" class="form-control" required>
                  <option value="">Select Category</option>
                  <option>Electronics</option>
                  <option>Bags & Luggage</option>
                  <option>Jewelry & Accessories</option>
                  <option>Keys</option>
                  <option>Clothing</option>
                  <option>Other</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="Description" rows="2" required></textarea>
              </div>
              <div class="col-md-6">
                <label class="form-label">Date Found</label>
                <input type="date" class="form-control" name="Date_found" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Location Found</label>
                <input type="text" class="form-control" name="Location_found" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Your Name</label>
                <input type="text" class="form-control" name="reportedBy" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Contact Number</label>
                <input type="tel" class="form-control" name="contactNo" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" name="email" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Upload Photo</label>
                <input type="file" class="form-control" name="upload_photo" accept="image/*">
              </div>
            </div>
            <button type="submit" class="btn btn-primary mt-4 w-100">Submit Report</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Item Details Modal -->
  <div class="modal fade" id="foundItemDetailsModal" tabindex="-1" aria-labelledby="foundItemDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Found Item Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="confirmClaimBtn">Claim Item</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container text-center">
      <p>&copy; 2025 QISCET ReclaimHub. All rights reserved.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    document.body.style.display = "block";

    const form = document.getElementById("itemForm");
    const itemsGrid = document.getElementById("itemsGrid");
    const searchInput = document.getElementById("searchInput");
    const categoryFilter = document.getElementById("categoryFilter");
    const reportModalEl = document.getElementById('reportItemModal');
    const reportModal = bootstrap.Modal.getOrCreateInstance(reportModalEl);

    const loginLogoutBtn = document.getElementById('loginLogoutBtn');
    const isLoggedIn = localStorage.getItem('loggedIn') === 'true';
    if (isLoggedIn) loginLogoutBtn.textContent = 'Logout';
    else { loginLogoutBtn.textContent = 'Login'; loginLogoutBtn.href = './login.html'; }
    loginLogoutBtn.addEventListener('click', (e) => {
      if (isLoggedIn) {
        e.preventDefault();
        localStorage.clear();
        window.location.reload();
      }
    });
    if (!isLoggedIn) window.location.href = "login.html";

    let allItems = [];
    let selectedItem = null;

    form.addEventListener("submit", handleFormSubmit);
    searchInput.addEventListener('keyup', handleFiltering);
    categoryFilter.addEventListener('change', handleFiltering);
    document.addEventListener("click", handleItemClick);

    loadItems();

    async function handleFormSubmit(e) {
      e.preventDefault();
      const formData = new FormData(form);
      try {
        const res = await fetch("https://lost-and-found-udyt.onrender.com/found/add", { method: "POST", body: formData });
        const data = await res.json();
        alert(data.message);
        form.reset();
        reportModal.hide();
        loadItems();
      } catch (err) {
        console.error(err);
        alert("Failed to submit report.");
      }
    }

    async function loadItems() {
      try {
        const res = await fetch("https://lost-and-found-udyt.onrender.com/found");
        const data = await res.json();
        allItems = data.items || [];
        renderItems(allItems);
      } catch {
        itemsGrid.innerHTML = `<p class="text-center text-danger">Error loading items.</p>`;
      }
    }

    function renderItems(items) {
      if (!items.length) {
        itemsGrid.innerHTML = `<p class="text-center text-muted col-12">No items found.</p>`;
        return;
      }
      itemsGrid.innerHTML = items.map(item => `
        <div class="col-lg-3 col-md-4 col-sm-6">
          <div class="card item-card">
            ${item.upload_photo ? `<img src="https://lost-and-found-udyt.onrender.com${item.upload_photo}" class="item-image">`
            : `<div class='item-image-placeholder'>No Image</div>`}
            <div class="card-body">
              <h5>${item.Item_Name}</h5>
              <p>Found near ${item.Location_found}</p>
              <button class="btn btn-outline-primary w-100 view-btn" data-id="${item._id}">View Details</button>
            </div>
          </div>
        </div>`).join("");
    }

    function handleFiltering() {
      const search = searchInput.value.toLowerCase();
      const cat = categoryFilter.value;
      const filtered = allItems.filter(i =>
        (i.Item_Name.toLowerCase().includes(search) || i.Description.toLowerCase().includes(search)) &&
        (cat === 'Filter by Category' || i.category === cat)
      );
      renderItems(filtered);
    }

    function handleItemClick(e) {
      if (e.target.classList.contains("view-btn")) {
        selectedItem = allItems.find(i => i._id === e.target.dataset.id);
        showItemDetails(selectedItem);
      }
      if (e.target.id === "confirmClaimBtn" && selectedItem) confirmClaim(selectedItem);
    }

    function showItemDetails(item) {
      const modalEl = document.getElementById("foundItemDetailsModal");
      const modalBody = modalEl.querySelector(".modal-body");
      modalBody.innerHTML = `
        ${item.upload_photo ? `<img src="https://lost-and-found-udyt.onrender.com${item.upload_photo}" class="img-fluid mb-3 rounded">` : ""}
        <h5>${item.Item_Name}</h5>
        <p><b>Category:</b> ${item.category}</p>
        <p><b>Description:</b> ${item.Description}</p>
        <p><b>Date Found:</b> ${new Date(item.Date_found).toLocaleDateString()}</p>
        <p><b>Location Found:</b> ${item.Location_found}</p>
        <p><b>Reported By:</b> ${item.reportedBy}</p>
        <p><b>Contact:</b> ${item.contactNo}</p>
      `;
      const modal = new bootstrap.Modal(modalEl);
      modal.show();
    }

    async function confirmClaim(item) {
      const claimerName = localStorage.getItem("username") || prompt("Enter your name:");
      const claimerEmail = localStorage.getItem("userEmail") || prompt("Enter your email:");
      if (!claimerName || !claimerEmail) return alert("Both fields required.");

      try {
        const res = await fetch(`https://lost-and-found-udyt.onrender.com/found/claim/${item._id}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ claimerName, claimerEmail })
        });
        const data = await res.json();
        alert(data.message || "Claim submitted.");
        bootstrap.Modal.getInstance(document.getElementById("foundItemDetailsModal")).hide();
        allItems = allItems.filter(i => i._id !== item._id);
        handleFiltering();
      } catch {
        alert("Error claiming item.");
      }
    }
  });
  </script>
</body>
</html>
